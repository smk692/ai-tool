# Implementation Plan: Hugging Face ë‹¤êµ­ì–´ ì„ë² ë”© í†µí•© ë° ê²€ì¦

**Branch**: `002-embedding-validation` | **Date**: 2025-01-17 | **Spec**: [spec.md](./spec.md)
**Input**: Feature specification from `/specs/002-embedding-validation/spec.md`

**Note**: This plan is generated by the `/speckit.plan` command for User Story 2.

## Summary

**Primary Requirement**: Hugging Face paraphrase-multilingual-MiniLM-L12-v2 ì„ë² ë”© ëª¨ë¸ì„ í†µí•©í•˜ê³  í•œêµ­ì–´ ê²€ìƒ‰ í’ˆì§ˆì„ ê²€ì¦í•©ë‹ˆë‹¤ (Top-5 ì •í™•ë„ â‰¥90%, ê²€ìƒ‰ ì§€ì—°ì‹œê°„ â‰¤0.5ì´ˆ).

**Technical Approach**:
1. **HuggingFaceEmbedding ì„œë¹„ìŠ¤ êµ¬í˜„** (`src/services/embeddings.py`) - sentence-transformers ê¸°ë°˜ ì„ë² ë”© ìƒì„±
2. **ChromaDB í†µí•© ì—…ë°ì´íŠ¸** - Pre-computed embeddings ì‚¬ìš©ìœ¼ë¡œ ì „í™˜
3. **ë¬¸ì„œ ì¸ë±ì‹± íŒŒì´í”„ë¼ì¸** - ë°°ì¹˜ ì²˜ë¦¬ ë° ì§„í–‰ ìƒí™© ì¶”ì 
4. **í’ˆì§ˆ ê²€ì¦ í…ŒìŠ¤íŠ¸** - 100 ì¿¼ë¦¬ í…ŒìŠ¤íŠ¸ì…‹ìœ¼ë¡œ ì •í™•ë„ ë° ì§€ì—°ì‹œê°„ ë²¤ì¹˜ë§ˆí¬
5. **OpenAI ì„ë² ë”© ì œê±°** - ì½”ë“œë² ì´ìŠ¤ì—ì„œ ì™„ì „ ì œê±° í™•ì¸

## Technical Context

**Language/Version**: Python 3.10+
**Primary Dependencies**:
- `sentence-transformers>=2.2.0` (ì„ë² ë”© ëª¨ë¸)
- `chromadb>=0.4.0` (ë²¡í„° ìŠ¤í† ì–´)
- `langchain-anthropic>=0.1.0` (Claude Code API)
- `pytest>=7.0.0` (í…ŒìŠ¤íŒ…)

**Storage**:
- ChromaDB (ë²¡í„° ìŠ¤í† ì–´, ë¡œì»¬ persistence)
- PostgreSQL 13+ (ì½ê¸° ì „ìš© ë¶„ì„ ë°ì´í„°)
- SQLite 3.35+ (ëŒ€í™” ë©”ëª¨ë¦¬)

**Testing**:
- pytest (ë‹¨ìœ„ í…ŒìŠ¤íŠ¸, í†µí•© í…ŒìŠ¤íŠ¸)
- pytest-benchmark (ì„±ëŠ¥ ë²¤ì¹˜ë§ˆí¬)
- pytest-cov (ì»¤ë²„ë¦¬ì§€ ì¸¡ì •)

**Target Platform**: Linux/macOS server (CPU ì „ìš©)

**Project Type**: Single Python project (backend service)

**Performance Goals**:
- ê²€ìƒ‰ ì§€ì—°ì‹œê°„ P95 â‰¤0.5ì´ˆ
- ë°°ì¹˜ 100ê°œ ì„ë² ë”© ìƒì„± â‰¤2ì´ˆ (CPU)
- 1000ê°œ ë¬¸ì„œ ì¸ë±ì‹± â‰¤5ë¶„

**Constraints**:
- CPU ì „ìš© (GPU ì—†ìŒ)
- ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ <1GB (ëª¨ë¸ + ë°°ì¹˜ ì²˜ë¦¬)
- ì›” ë¹„ìš© $0 (ì™„ì „ ë¬´ë£Œ ì˜¤í”ˆì†ŒìŠ¤)

**Scale/Scope**:
- 1000~10000ê°œ ë¬¸ì„œ ì§€ì›
- 100 ì¿¼ë¦¬ í…ŒìŠ¤íŠ¸ì…‹ ë²¤ì¹˜ë§ˆí¬
- 9ê°œ ì‘ì—… (T041-T049)

## Constitution Check

*GATE: Must pass before Phase 0 research. Re-check after Phase 1 design.*

### I. ë¹„ìš© íš¨ìœ¨ì„± ìš°ì„  (Cost-First)

| ìš”êµ¬ì‚¬í•­ | ì¤€ìˆ˜ ì—¬ë¶€ | ê²€ì¦ ë°©ë²• |
|---------|----------|----------|
| ì›” ìš´ì˜ ë¹„ìš© $50 ì´í•˜ ìœ ì§€ | âœ… **PASS** | ì„ë² ë”© ëª¨ë¸ ì™„ì „ ë¬´ë£Œ (ì˜¤í”ˆì†ŒìŠ¤), API ë¹„ìš© $0 |
| ì˜¤í”ˆì†ŒìŠ¤ ì†”ë£¨ì…˜ ìš°ì„  | âœ… **PASS** | sentence-transformers (Apache 2.0), ChromaDB (Apache 2.0) |
| LLM API í˜¸ì¶œ ìµœì†Œí™” | âœ… **PASS** | ì„ë² ë”©ì€ ë¡œì»¬ ì¶”ë¡ , LLM API í˜¸ì¶œ ì—†ìŒ |
| ë¹„ìš© ì¶”ì  ì‹œìŠ¤í…œ | âœ… **PASS** | ì„ë² ë”© ë¹„ìš© $0ì´ë¯€ë¡œ ì¶”ì  ë¶ˆí•„ìš” |

**ê²°ë¡ **: âœ… **í—Œë²• ì¤€ìˆ˜** - ì™„ì „ ë¬´ë£Œ ì˜¤í”ˆì†ŒìŠ¤ ëª¨ë¸ ì‚¬ìš©ìœ¼ë¡œ ë¹„ìš© $0

---

### II. ì‘ë‹µ ì‹œê°„ ë³´ì¥ (Response Time SLA)

| ìš”êµ¬ì‚¬í•­ | ëª©í‘œ | ê²€ì¦ ë°©ë²• |
|---------|------|----------|
| Vector ê²€ìƒ‰ ì‘ë‹µì‹œê°„ | â‰¤0.5ì´ˆ | T046 í†µí•© í…ŒìŠ¤íŠ¸ (P95 ì¸¡ì •) |
| ë¬¸ì„œ ê²€ìƒ‰ ì‘ë‹µì‹œê°„ | <3ì´ˆ | E2E íŒŒì´í”„ë¼ì¸ í…ŒìŠ¤íŠ¸ |
| ì‹œìŠ¤í…œ ê°€ìš©ì„± | â‰¥99% | N/A (ì„ë² ë”© ì„œë¹„ìŠ¤ëŠ” ë¡œì»¬ ë™ì‘) |

**SLA ì˜í–¥**:
- ì„ë² ë”© ìƒì„± ì‹œê°„ì´ ê²€ìƒ‰ latencyì— ì§ì ‘ ì˜í–¥
- CPU ê¸°ë°˜ ì¶”ë¡ ì´ë¯€ë¡œ GPU ëŒ€ë¹„ ëŠë¦´ ìˆ˜ ìˆìŒ
- ë°°ì¹˜ ì²˜ë¦¬ ìµœì í™”ë¡œ ì²˜ë¦¬ëŸ‰ í–¥ìƒ í•„ìš”

**ê²€ì¦ ê³„íš**:
- T046: 100íšŒ ë°˜ë³µ ì¸¡ì •, P95 â‰¤0.5ì´ˆ í™•ì¸
- ë™ì‹œì„± í…ŒìŠ¤íŠ¸ (10 concurrent requests)
- ëŒ€ëŸ‰ ë¬¸ì„œ (1000, 5000, 10000) ì¸ë±ì‹± í›„ ê²€ìƒ‰ í…ŒìŠ¤íŠ¸

**ê²°ë¡ **: âš ï¸ **ê²€ì¦ í•„ìš”** - T046 í…ŒìŠ¤íŠ¸ í†µê³¼ ì‹œ PASS

---

### III. ì •í™•ë„ ìš°ì„  (Accuracy-First)

| ìš”êµ¬ì‚¬í•­ | ëª©í‘œ | ê²€ì¦ ë°©ë²• |
|---------|------|----------|
| ë¬¸ì„œ ê²€ìƒ‰ ì •í™•ë„ (Top-5) | â‰¥90% | T047 ë²¤ì¹˜ë§ˆí¬ (100 ì¿¼ë¦¬ í…ŒìŠ¤íŠ¸ì…‹) |
| ë‹µë³€ ì¶œì²˜ ëª…ì‹œ | âœ… ìœ ì§€ | ChromaDB ë©”íƒ€ë°ì´í„° í¬í•¨ ê²€ìƒ‰ ê²°ê³¼ |

**ì •í™•ë„ ì˜í–¥**:
- ë‹¤êµ­ì–´ ëª¨ë¸ (paraphrase-multilingual-MiniLM-L12-v2)ì€ í•œêµ­ì–´ ì§€ì›
- OpenAI ì„ë² ë”© ëŒ€ë¹„ í’ˆì§ˆ ë¹„êµ í•„ìš”
- ì„ë² ë”© ì°¨ì› 384 (OpenAIëŠ” 1536) - ë‚®ì€ ì°¨ì›ì´ ì •í™•ë„ì— ì˜í–¥ ê°€ëŠ¥

**ê²€ì¦ ê³„íš**:
- T047: í•œêµ­ì–´ ì¿¼ë¦¬ 50ê°œ, ì˜ì–´ 30ê°œ, í˜¼í•© 20ê°œ í…ŒìŠ¤íŠ¸
- Top-5 Accuracy, MRR ê³„ì‚°
- ì‹¤íŒ¨ ì¼€ì´ìŠ¤ ë¶„ì„

**ê²°ë¡ **: âš ï¸ **ê²€ì¦ í•„ìš”** - T047 ë²¤ì¹˜ë§ˆí¬ í†µê³¼ ì‹œ PASS

---

### IV. ì˜¤í”ˆì†ŒìŠ¤ ê¸°ë°˜ (Open-Source First)

| ì»´í¬ë„ŒíŠ¸ | ë¼ì´ì„ ìŠ¤ | ì¤€ìˆ˜ ì—¬ë¶€ |
|---------|---------|----------|
| sentence-transformers | Apache 2.0 | âœ… **PASS** |
| paraphrase-multilingual-MiniLM-L12-v2 | Apache 2.0 | âœ… **PASS** |
| ChromaDB | Apache 2.0 | âœ… **PASS** |

**ìƒìš© ë„êµ¬ ì œê±°**:
- âœ… OpenAI ì„ë² ë”© API ì™„ì „ ì œê±° (T041-T049)
- âœ… ë²¤ë” ë½ì¸ ì œê±° (Hugging Face ëª¨ë¸ì€ ë¡œì»¬ ìºì‹±)

**ê²°ë¡ **: âœ… **í—Œë²• ì¤€ìˆ˜** - ëª¨ë“  ì»´í¬ë„ŒíŠ¸ ì˜¤í”ˆì†ŒìŠ¤ (Apache 2.0)

---

### V. ë‹¨ìˆœì„± ìœ ì§€ (Simplicity)

| ìš”êµ¬ì‚¬í•­ | ì¤€ìˆ˜ ì—¬ë¶€ | ê·¼ê±° |
|---------|----------|------|
| KISS ì›ì¹™ | âœ… **PASS** | ë‹¨ì¼ ì„ë² ë”© ì„œë¹„ìŠ¤ í´ë˜ìŠ¤ (`HuggingFaceEmbedding`) |
| YAGNI | âœ… **PASS** | í˜„ì¬ í•„ìš”í•œ ê¸°ëŠ¥ë§Œ êµ¬í˜„ (ëª¨ë¸ ì„ ì • ì™„ë£Œ, ì¶”ê°€ íƒìƒ‰ ì—†ìŒ) |
| ë³µì¡ë„ ì¦ê°€ ì •ë‹¹í™” | âœ… **PASS** | ë¹„ìš© ì ˆê° ë° ì˜¤í”ˆì†ŒìŠ¤ ë…ë¦½ì„± í™•ë³´ |

**ë³µì¡ë„ ë¶„ì„**:
- **ì¶”ê°€ë˜ëŠ” ë³µì¡ë„**: ì„ë² ë”© ì„œë¹„ìŠ¤ êµ¬í˜„ (1ê°œ í´ë˜ìŠ¤)
- **ì œê±°ë˜ëŠ” ë³µì¡ë„**: OpenAI API ì˜ì¡´ì„± ì œê±°
- **ìˆœ ë³µì¡ë„**: ì¤‘ë¦½ ë˜ëŠ” ê°ì†Œ

**ê²°ë¡ **: âœ… **í—Œë²• ì¤€ìˆ˜** - ë‹¨ìˆœì„± ìœ ì§€

---

### VI. ë³´ì•ˆ ìš°ì„  (Security-First)

| ìš”êµ¬ì‚¬í•­ | ì¤€ìˆ˜ ì—¬ë¶€ | ê²€ì¦ ë°©ë²• |
|---------|----------|----------|
| ì½ê¸° ì „ìš© DB ê³„ì • | N/A | ì„ë² ë”©ì€ DB ì ‘ê·¼ ì—†ìŒ |
| SQL Injection ë°©ì§€ | N/A | SQL ì¿¼ë¦¬ ìƒì„± ì—†ìŒ |
| API í‚¤ ê´€ë¦¬ | âœ… **PASS** | OpenAI API í‚¤ ì œê±°, ë¡œì»¬ ëª¨ë¸ ì‚¬ìš© |
| ë¡œê·¸ ê°œì¸ì •ë³´ ë¯¸í¬í•¨ | âœ… **PASS** | ì„ë² ë”© ë²¡í„°ëŠ” ë¹„ì‹ë³„í™” |

**ë³´ì•ˆ ê°œì„ **:
- âœ… ì™¸ë¶€ API ì˜ì¡´ì„± ì œê±° (OpenAI â†’ Hugging Face ë¡œì»¬)
- âœ… API í‚¤ ë…¸ì¶œ ë¦¬ìŠ¤í¬ ì œê±°
- âœ… ë°ì´í„° ì™¸ë¶€ ì „ì†¡ ì—†ìŒ (ëª¨ë“  ì²˜ë¦¬ ë¡œì»¬)

**ê²°ë¡ **: âœ… **í—Œë²• ì¤€ìˆ˜** - ë³´ì•ˆ ê°•í™”

---

### ì „ì²´ í‰ê°€

| ì›ì¹™ | ìƒíƒœ | ë¹„ê³  |
|------|------|------|
| I. ë¹„ìš© íš¨ìœ¨ì„± ìš°ì„  | âœ… **PASS** | ë¹„ìš© $0 |
| II. ì‘ë‹µ ì‹œê°„ ë³´ì¥ | âš ï¸ **ê²€ì¦ í•„ìš”** | T046 í…ŒìŠ¤íŠ¸ í†µê³¼ ì‹œ PASS |
| III. ì •í™•ë„ ìš°ì„  | âš ï¸ **ê²€ì¦ í•„ìš”** | T047 ë²¤ì¹˜ë§ˆí¬ í†µê³¼ ì‹œ PASS |
| IV. ì˜¤í”ˆì†ŒìŠ¤ ê¸°ë°˜ | âœ… **PASS** | ëª¨ë“  ì»´í¬ë„ŒíŠ¸ Apache 2.0 |
| V. ë‹¨ìˆœì„± ìœ ì§€ | âœ… **PASS** | ë³µì¡ë„ ì¤‘ë¦½ |
| VI. ë³´ì•ˆ ìš°ì„  | âœ… **PASS** | ë³´ì•ˆ ê°•í™” |

**ìµœì¢… ê²°ë¡ **: âœ… **Phase 0 ì—°êµ¬ ì§„í–‰ ìŠ¹ì¸**
- 5/6 ì›ì¹™ ì¦‰ì‹œ ì¤€ìˆ˜
- 2/6 ì›ì¹™ì€ Phase 4 í…ŒìŠ¤íŠ¸ ì™„ë£Œ í›„ ìµœì¢… í™•ì¸ í•„ìš”
- í—Œë²• ìœ„ë°˜ ì—†ìŒ, ë³µì¡ë„ ì¦ê°€ ì •ë‹¹í™”ë¨

**ì¬ê²€ì¦ ì‹œì **: Phase 1 ì„¤ê³„ ì™„ë£Œ í›„ (data-model.md, contracts/ ìƒì„± í›„)

## Project Structure

### Documentation (this feature)

```text
specs/002-embedding-validation/
â”œâ”€â”€ spec.md              # âœ… Feature specification (already created)
â”œâ”€â”€ plan.md              # âœ… This file (/speckit.plan output - in progress)
â”œâ”€â”€ research.md          # Phase 0 output (ëª¨ë¸ ì„ ì • ì™„ë£Œ, ìƒëµ ê°€ëŠ¥)
â”œâ”€â”€ data-model.md        # Phase 1 output (ì„ë² ë”© ì—”í‹°í‹°)
â”œâ”€â”€ quickstart.md        # Phase 1 output (ë¹ ë¥¸ ì‹œì‘ ê°€ì´ë“œ)
â”œâ”€â”€ contracts/           # Phase 1 output (API ê³„ì•½ì„œ - N/A for this feature)
â””â”€â”€ tasks.md             # Phase 2 output (/speckit.tasks - T041-T049)
```

### Source Code (repository root)

**Single Python Project Structure** (Option 1 ì„ íƒ):

```text
src/
â”œâ”€â”€ models/
â”‚   â””â”€â”€ embedding.py         # âœ… ê¸°ì¡´: EmbeddingConfiguration ì—”í‹°í‹°
â”œâ”€â”€ services/
â”‚   â”œâ”€â”€ embeddings.py        # ğŸ†• HuggingFaceEmbedding í´ë˜ìŠ¤ (T042)
â”‚   â”œâ”€â”€ vector_store.py      # ğŸ”„ ChromaDB í†µí•© ì—…ë°ì´íŠ¸ (T043)
â”‚   â””â”€â”€ llm_client.py        # âœ… ê¸°ì¡´: Claude Code í´ë¼ì´ì–¸íŠ¸
â”œâ”€â”€ chains/
â”‚   â”œâ”€â”€ knowledge.py         # ğŸ”„ ì„ë² ë”© ì„œë¹„ìŠ¤ ì‚¬ìš© (ê°„ì ‘ ì˜í–¥)
â”‚   â””â”€â”€ ...                  # ê¸°íƒ€ ì²´ì¸ (ë³€ê²½ ì—†ìŒ)
â”œâ”€â”€ db/
â”‚   â”œâ”€â”€ postgres.py          # âœ… ê¸°ì¡´: PostgreSQL ì—°ê²°
â”‚   â””â”€â”€ memory.py            # âœ… ê¸°ì¡´: SQLite ë©”ëª¨ë¦¬
â””â”€â”€ utils/
    â”œâ”€â”€ prompts.py           # âœ… ê¸°ì¡´: í”„ë¡¬í”„íŠ¸ í…œí”Œë¦¿
    â””â”€â”€ logging.py           # âœ… ê¸°ì¡´: ë¡œê¹…

scripts/
â”œâ”€â”€ download_embedding_model.py  # âœ… ê¸°ì¡´: ëª¨ë¸ ìºì‹±
â”œâ”€â”€ init_vector_store.py         # âœ… ê¸°ì¡´: ChromaDB ì´ˆê¸°í™”
â”œâ”€â”€ index_documents.py           # ğŸ†• ë¬¸ì„œ ì¸ë±ì‹± ìœ í‹¸ë¦¬í‹° (T044)
â””â”€â”€ validate_embedding_quality.py # ğŸ”„ ë²¤ì¹˜ë§ˆí¬ ìŠ¤í¬ë¦½íŠ¸ (ì—…ë°ì´íŠ¸)

tests/
â”œâ”€â”€ unit/
â”‚   â”œâ”€â”€ test_embeddings.py       # ğŸ†• ì„ë² ë”© ì„œë¹„ìŠ¤ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (T045)
â”‚   â””â”€â”€ ...                      # ê¸°ì¡´ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸
â”œâ”€â”€ integration/
â”‚   â”œâ”€â”€ test_vector_search.py    # ğŸ†• E2E ê²€ìƒ‰ í†µí•© í…ŒìŠ¤íŠ¸ (T046)
â”‚   â””â”€â”€ ...                      # ê¸°ì¡´ í†µí•© í…ŒìŠ¤íŠ¸
â””â”€â”€ benchmarks/
    â””â”€â”€ test_embedding_accuracy.py # ğŸ†• ì •í™•ë„ ë²¤ì¹˜ë§ˆí¬ (T047)

config/
â””â”€â”€ settings.py                  # âœ… ê¸°ì¡´: ì„ë² ë”© ì„¤ì • (ì´ë¯¸ êµ¬ì„±ë¨)

data/
â””â”€â”€ chroma/                      # âœ… ê¸°ì¡´: ChromaDB persistence
```

**Structure Decision**: Single Python project (Option 1)ì„ ì‚¬ìš©í•©ë‹ˆë‹¤.
- ì´ìœ : Backend ì„œë¹„ìŠ¤ ë‹¨ì¼ í”„ë¡œì íŠ¸ì´ë©°, frontendê°€ ì—†ìŒ
- ë³€ê²½ ì‚¬í•­:
  - ğŸ†• 3ê°œ ì‹ ê·œ íŒŒì¼: `src/services/embeddings.py`, `scripts/index_documents.py`, `tests/unit/test_embeddings.py`
  - ğŸ”„ 2ê°œ ì—…ë°ì´íŠ¸: `src/services/vector_store.py`, `tests/integration/test_vector_search.py`
  - âœ… ê¸°ì¡´ êµ¬ì¡° ìœ ì§€, ìµœì†Œ ë³€ê²½ ì›ì¹™ ì¤€ìˆ˜

## Complexity Tracking

> **Fill ONLY if Constitution Check has violations that must be justified**

**N/A** - Constitution Checkì—ì„œ ìœ„ë°˜ ì‚¬í•­ ì—†ìŒ. ëª¨ë“  ì›ì¹™ ì¤€ìˆ˜ ë˜ëŠ” ê²€ì¦ ì˜ˆì •.

---

## Phase 0: Outline & Research

### Research Status

**ëª¨ë¸ ì„ ì • ì™„ë£Œ** (Phase 1-2ì—ì„œ ì´ë¯¸ ì™„ë£Œ):
- âœ… ëª¨ë¸: `paraphrase-multilingual-MiniLM-L12-v2` ì„ ì •
- âœ… ê·¼ê±°: ë‹¤êµ­ì–´ ì§€ì› (í•œêµ­ì–´ í¬í•¨), 384ì°¨ì›, Apache 2.0 ë¼ì´ì„ ìŠ¤
- âœ… ëŒ€ì•ˆ í‰ê°€: ê¸°ì¡´ spec.mdì˜ "FR-003" ì°¸ì¡°

**research.md ìƒëµ ê°€ëŠ¥**:
- ëª¨ë¸ ë° ê¸°ìˆ  ìŠ¤íƒ ê²°ì • ì™„ë£Œ
- ì¶”ê°€ ì—°êµ¬ ë¶ˆí•„ìš”
- spec.md Section 2.1 "Phase 1-2ì—ì„œ ì™„ë£Œëœ ì‚¬í•­"ì— ì´ë¯¸ ë¬¸ì„œí™”ë¨

**í•„ìš” ì‹œ research.md ìƒì„± í•­ëª©**:
1. **ì—†ìŒ** - ëª¨ë“  ê¸°ìˆ  ê²°ì • ì™„ë£Œ

**Phase 0 ê²°ë¡ **: âœ… **SKIP** (ëª¨ë¸ ì„ ì • ë° ê¸°ìˆ  ìŠ¤íƒ í™•ì •ë¨)

---

## Phase 1: Design & Contracts

### Phase 1 Overview

**ëª©í‘œ**: ë°ì´í„° ëª¨ë¸, API ê³„ì•½, ë¹ ë¥¸ ì‹œì‘ ê°€ì´ë“œ ì‘ì„±

**ì‚°ì¶œë¬¼**:
1. `data-model.md` - ì„ë² ë”© ê´€ë ¨ ì—”í‹°í‹° ë° ë°ì´í„° íë¦„
2. `quickstart.md` - ì„ë² ë”© ì„œë¹„ìŠ¤ ì‚¬ìš© ê°€ì´ë“œ
3. `contracts/` - N/A (ë‚´ë¶€ ì„œë¹„ìŠ¤ API, ì™¸ë¶€ ê³„ì•½ ì—†ìŒ)

---

### 1. Data Model Design (data-model.md)

**ì—”í‹°í‹° ì¶”ì¶œ** (spec.md Section 5.2 ê¸°ë°˜):

#### A. EmbeddingConfiguration (ê¸°ì¡´)

**ìœ„ì¹˜**: `src/models/embedding.py` (ì´ë¯¸ ì¡´ì¬)

**í•„ë“œ**:
```python
class DeviceType(Enum):
    CPU = "cpu"
    CUDA = "cuda"
    MPS = "mps"

class EmbeddingConfiguration:
    model_name: str = "paraphrase-multilingual-MiniLM-L12-v2"
    embedding_dim: int = 384
    device: DeviceType = DeviceType.CPU
    batch_size: int = 100
    max_sequence_length: int = 512
```

**ê²€ì¦ ê·œì¹™**:
- embedding_dim == 384 (ëª¨ë¸ ìŠ¤í™ê³¼ ì¼ì¹˜)
- batch_size > 0
- max_sequence_length â‰¤ 512 (ëª¨ë¸ ì œí•œ)

**ìƒíƒœ ì „ì´**: N/A (ì„¤ì • ê°ì²´, ìƒíƒœ ì—†ìŒ)

---

#### B. HuggingFaceEmbedding (ì‹ ê·œ)

**ìœ„ì¹˜**: `src/services/embeddings.py` (T042ì—ì„œ ìƒì„±)

**ë©”ì„œë“œ**:
```python
class HuggingFaceEmbedding:
    def __init__(self, config: EmbeddingConfiguration)
    def embed_text(self, text: str) -> List[float]
    def embed_texts(self, texts: List[str]) -> List[List[float]]
    def get_embedding_dimension(self) -> int
    def validate_model(self) -> bool
```

**ê²€ì¦ ê·œì¹™**:
- ë¹ˆ í…ìŠ¤íŠ¸ ì…ë ¥ â†’ `ValueError`
- ì„ë² ë”© ì°¨ì› == 384
- ê¸´ í…ìŠ¤íŠ¸ (>512 í† í°) â†’ ìë™ truncation

**ìƒíƒœ ì „ì´**: N/A (stateless ì„œë¹„ìŠ¤)

---

#### C. VectorStore (ì—…ë°ì´íŠ¸)

**ìœ„ì¹˜**: `src/services/vector_store.py` (T043ì—ì„œ ì—…ë°ì´íŠ¸)

**ë³€ê²½ ì‚¬í•­**:
```python
class VectorStore:
    def __init__(
        self,
        config: ChromaDBConfig,
        embedding_service: HuggingFaceEmbedding  # ğŸ†• ì¶”ê°€
    )

    def add_documents(
        self,
        documents: List[str],
        metadatas: Optional[List[Dict]] = None,
        embeddings: Optional[List[List[float]]] = None  # ê¸°ì¡´
    ) -> Dict[str, Any]

    def query(
        self,
        query_text: str,
        top_k: int = 5
    ) -> Dict[str, Any]
```

**ê²€ì¦ ê·œì¹™**:
- embeddings == Noneì´ë©´ embedding_service ì‚¬ìš©
- query_text â†’ embedding_service.embed_text() í˜¸ì¶œ

---

#### D. ë°ì´í„° íë¦„

**ë¬¸ì„œ ì¶”ê°€**:
```
User â†’ VectorStore.add_documents(documents)
  â†’ embedding_service.embed_texts(documents)  # ë°°ì¹˜ ì²˜ë¦¬
  â†’ ChromaDB.collection.add(embeddings=...)
  â†’ Success Response
```

**ì¿¼ë¦¬ ê²€ìƒ‰**:
```
User â†’ VectorStore.query(query_text, top_k=5)
  â†’ embedding_service.embed_text(query_text)  # ë‹¨ì¼ ì¿¼ë¦¬
  â†’ ChromaDB.collection.query(query_embeddings=...)
  â†’ Results (documents, metadatas, distances)
```

---

### 2. API Contracts (contracts/)

**N/A** - ì´ featureëŠ” ë‚´ë¶€ ì„œë¹„ìŠ¤ì´ë¯€ë¡œ ì™¸ë¶€ API ê³„ì•½ ë¶ˆí•„ìš”

**ë‚´ë¶€ API ì‚¬ì–‘** (spec.md Section 5.2 ì°¸ì¡°):
- `HuggingFaceEmbedding` í´ë˜ìŠ¤ ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜
- `VectorStore` ì—…ë°ì´íŠ¸ ë©”ì„œë“œ ì‹œê·¸ë‹ˆì²˜
- ì´ë¯¸ spec.mdì— ë¬¸ì„œí™”ë¨

---

### 3. Quickstart Guide (quickstart.md)

**ë‚´ìš©**:
1. **ì„¤ì¹˜ ë° ì„¤ì •**:
   - ëª¨ë¸ ë‹¤ìš´ë¡œë“œ: `python scripts/download_embedding_model.py`
   - í™˜ê²½ ë³€ìˆ˜ ì„¤ì •: `.env` íŒŒì¼

2. **ì„ë² ë”© ì„œë¹„ìŠ¤ ì‚¬ìš©**:
   ```python
   from src.services.embeddings import HuggingFaceEmbedding
   from src.models.embedding import EmbeddingConfiguration

   config = EmbeddingConfiguration()
   embedding_service = HuggingFaceEmbedding(config)

   # ë‹¨ì¼ í…ìŠ¤íŠ¸
   vector = embedding_service.embed_text("í•œêµ­ì–´ í…ŒìŠ¤íŠ¸")

   # ë°°ì¹˜ ì²˜ë¦¬
   vectors = embedding_service.embed_texts(["í…ìŠ¤íŠ¸1", "í…ìŠ¤íŠ¸2"])
   ```

3. **ë¬¸ì„œ ì¸ë±ì‹±**:
   ```bash
   python scripts/index_documents.py \
       --source data/documents/ \
       --format json \
       --batch-size 100
   ```

4. **ê²€ìƒ‰ í…ŒìŠ¤íŠ¸**:
   ```python
   from src/services.vector_store import VectorStore

   results = vector_store.query("PostgreSQL íŠ¸ëœì­ì…˜", top_k=5)
   ```

---

### Phase 1 ì‚°ì¶œë¬¼ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] `data-model.md` ì‘ì„± ì™„ë£Œ
- [ ] `quickstart.md` ì‘ì„± ì™„ë£Œ
- [ ] `contracts/` - N/A (ìŠ¤í‚µ)
- [ ] Agent context ì—…ë°ì´íŠ¸ (`.specify/scripts/bash/update-agent-context.sh claude`)

---

### Constitution Check (Re-evaluation)

**Phase 1 ì„¤ê³„ ì™„ë£Œ í›„ ì¬ê²€ì¦**:

| ì›ì¹™ | ì„¤ê³„ ë‹¨ê³„ í‰ê°€ | ë¹„ê³  |
|------|---------------|------|
| I. ë¹„ìš© íš¨ìœ¨ì„± | âœ… **PASS** | ì„¤ê³„ì— ë¹„ìš© ì¦ê°€ ìš”ì†Œ ì—†ìŒ |
| II. ì‘ë‹µ ì‹œê°„ | âš ï¸ **êµ¬í˜„ í›„ ê²€ì¦** | ì„¤ê³„ìƒ SLA ì¤€ìˆ˜ ê°€ëŠ¥ |
| III. ì •í™•ë„ | âš ï¸ **êµ¬í˜„ í›„ ê²€ì¦** | ëª¨ë¸ ì„ ì • ì™„ë£Œ, í…ŒìŠ¤íŠ¸ í•„ìš” |
| IV. ì˜¤í”ˆì†ŒìŠ¤ | âœ… **PASS** | ëª¨ë“  ì»´í¬ë„ŒíŠ¸ ì˜¤í”ˆì†ŒìŠ¤ |
| V. ë‹¨ìˆœì„± | âœ… **PASS** | ìµœì†Œ êµ¬ì¡°, ë¶ˆí•„ìš”í•œ ì¶”ìƒí™” ì—†ìŒ |
| VI. ë³´ì•ˆ | âœ… **PASS** | ì™¸ë¶€ API ì œê±°ë¡œ ë³´ì•ˆ ê°•í™” |

**ì¬ê²€ì¦ ê²°ë¡ **: âœ… **Phase 2 (Tasks) ì§„í–‰ ìŠ¹ì¸**

---

## Phase 2: Tasks Breakdown

**Note**: Phase 2 ì‚°ì¶œë¬¼ì¸ `tasks.md`ëŠ” `/speckit.tasks` ëª…ë ¹ìœ¼ë¡œ ìƒì„±ë©ë‹ˆë‹¤.

**ì˜ˆìƒ ì‘ì—…** (spec.md Section 6 ê¸°ë°˜):
- T041: ëª¨ë¸ ì„¤ì • ê²€ì¦ (1h)
- T042: HuggingFaceEmbedding ì„œë¹„ìŠ¤ êµ¬í˜„ (4h)
- T043: ChromaDB í†µí•© ì—…ë°ì´íŠ¸ (3h)
- T044: ë¬¸ì„œ ì¸ë±ì‹± ìœ í‹¸ë¦¬í‹° (4h)
- T045: í•œêµ­ì–´ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ (3h)
- T046: ë²¡í„° ê²€ìƒ‰ ì§€ì—°ì‹œê°„ í…ŒìŠ¤íŠ¸ (4h)
- T047: Top-5 ì •í™•ë„ ë²¤ì¹˜ë§ˆí¬ (6h)
- T048: ë‹¤êµ­ì–´ ì§€ì› í…ŒìŠ¤íŠ¸ (3h)
- T049: ë¬¸ì„œí™” (4h)

**ì´ ì˜ˆìƒ ì‹œê°„**: 32ì‹œê°„

---

## Implementation Timeline

### Week 1: ì„œë¹„ìŠ¤ êµ¬í˜„ (T041-T044)

**Day 1-2**:
- T041: ëª¨ë¸ ì„¤ì • ê²€ì¦
- T042: HuggingFaceEmbedding ì„œë¹„ìŠ¤ êµ¬í˜„ ì‹œì‘

**Day 3-4**:
- T042 ì™„ë£Œ
- T043: ChromaDB í†µí•© ì—…ë°ì´íŠ¸

**Day 5**:
- T044: ë¬¸ì„œ ì¸ë±ì‹± ìœ í‹¸ë¦¬í‹° êµ¬í˜„

**Milestone**: 1000ê°œ ë¬¸ì„œ ì¸ë±ì‹± ì„±ê³µ

---

### Week 2: í…ŒìŠ¤íŠ¸ ë° ê²€ì¦ (T045-T048)

**Day 1-2**:
- T045: í•œêµ­ì–´ ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ ì‘ì„±

**Day 3**:
- T046: ë²¡í„° ê²€ìƒ‰ ì§€ì—°ì‹œê°„ í…ŒìŠ¤íŠ¸

**Day 4-5**:
- T047: Top-5 ì •í™•ë„ ë²¤ì¹˜ë§ˆí¬

**Day 6**:
- T048: ë‹¤êµ­ì–´ ì§€ì› í…ŒìŠ¤íŠ¸

**Milestone**: ëª¨ë“  ìˆ˜ë½ ê¸°ì¤€ í†µê³¼

---

### Week 3: ë¬¸ì„œí™” ë° ìµœì¢… ê²€ì¦ (T049)

**Day 1-2**:
- T049: ë¬¸ì„œí™” (`docs/embedding-model.md`)

**Day 3-4**:
- ì„±ëŠ¥ ìµœì í™” (í•„ìš” ì‹œ)
- Constitution Check ìµœì¢… í™•ì¸

**Day 5**:
- ìµœì¢… ê²€ì¦ ë° ë°°í¬ ì¤€ë¹„
- Phase 4 ì™„ë£Œ ë³´ê³ 

**Milestone**: User Story 2 ì™„ë£Œ

---

## Risk Management

### ë¦¬ìŠ¤í¬ 1: í•œêµ­ì–´ ì„ë² ë”© í’ˆì§ˆ ë¯¸ë‹¬

**ë¦¬ìŠ¤í¬**: Top-5 ì •í™•ë„ <90%

**í™•ë¥ **: ë‚®ìŒ (ëª¨ë¸ì€ ì´ë¯¸ í•œêµ­ì–´ ì§€ì› ê²€ì¦ë¨)

**ì™„í™” ì „ëµ**:
- ë‹¤ì–‘í•œ í•œêµ­ì–´ ì¿¼ë¦¬ë¡œ ì‚¬ì „ í…ŒìŠ¤íŠ¸
- í•„ìš” ì‹œ í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰ (BM25 + Vector) í™œìš©
- Fine-tuning ê²€í†  (Phase ì™¸)

**íŠ¸ë¦¬ê±°**: T047 ë²¤ì¹˜ë§ˆí¬ ê²°ê³¼ <90%

---

### ë¦¬ìŠ¤í¬ 2: ê²€ìƒ‰ ì§€ì—°ì‹œê°„ SLA ë¯¸ë‹¬

**ë¦¬ìŠ¤í¬**: P95 ì‘ë‹µì‹œê°„ >0.5ì´ˆ

**í™•ë¥ **: ì¤‘ê°„ (CPU ê¸°ë°˜ ì¶”ë¡ )

**ì™„í™” ì „ëµ**:
- ë°°ì¹˜ í¬ê¸° ìµœì í™”
- ChromaDB ì¸ë±ìŠ¤ íŠœë‹
- ìºì‹± ì „ëµ ë„ì… (ìì£¼ ê²€ìƒ‰ë˜ëŠ” ì¿¼ë¦¬)

**íŠ¸ë¦¬ê±°**: T046 í…ŒìŠ¤íŠ¸ P95 >0.5ì´ˆ

---

### ë¦¬ìŠ¤í¬ 3: ë©”ëª¨ë¦¬ ë¶€ì¡±

**ë¦¬ìŠ¤í¬**: ëŒ€ëŸ‰ ë¬¸ì„œ ì²˜ë¦¬ ì‹œ ë©”ëª¨ë¦¬ ë¶€ì¡±

**í™•ë¥ **: ë‚®ìŒ

**ì™„í™” ì „ëµ**:
- ë°°ì¹˜ í¬ê¸° ë™ì  ì¡°ì •
- ë¬¸ì„œ ìŠ¤íŠ¸ë¦¬ë° ì²˜ë¦¬
- ê°€ë¹„ì§€ ì»¬ë ‰ì…˜ ëª…ì‹œì  í˜¸ì¶œ

**íŠ¸ë¦¬ê±°**: ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ >800MB

---

## Success Criteria (Final Validation)

### ê¸°ëŠ¥ì  ì§€í‘œ

- [ ] Top-5 ê²€ìƒ‰ ì •í™•ë„ â‰¥90% (T047)
- [ ] ê²€ìƒ‰ ì§€ì—°ì‹œê°„ P95 â‰¤0.5ì´ˆ (T046)
- [ ] 1000ê°œ ë¬¸ì„œ ì¸ë±ì‹± ì„±ê³µë¥  â‰¥99% (T044)
- [ ] OpenAI ì„ë² ë”© ì°¸ì¡° 0ê±´ (T041)

### í’ˆì§ˆ ì§€í‘œ

- [ ] í…ŒìŠ¤íŠ¸ ì»¤ë²„ë¦¬ì§€ â‰¥80% (T045, T046, T047, T048)
- [ ] ë‹¨ìœ„ í…ŒìŠ¤íŠ¸ í†µê³¼ìœ¨ 100%
- [ ] í†µí•© í…ŒìŠ¤íŠ¸ í†µê³¼ìœ¨ 100%
- [ ] ì½”ë“œ ë¦¬ë·° ìŠ¹ì¸

### ë¹„ìš© ì§€í‘œ

- [ ] ì„ë² ë”© ë¹„ìš© $0 (ì™„ì „ ë¬´ë£Œ)
- [ ] ì›” ì˜ˆì‚° ì ˆê° (OpenAI API ë¹„ìš© ì œê±°)

---

## References

### í”„ë¡œì íŠ¸ ë¬¸ì„œ

- [Feature Specification](./spec.md) - User Story 2 ìƒì„¸ ëª…ì„¸
- [Constitution](../../.specify/memory/constitution.md) - í”„ë¡œì íŠ¸ í—Œë²• v1.0.0
- [User Story 1 Plan](../001-claude-huggingface-migration/plan.md) - Claude ë§ˆì´ê·¸ë ˆì´ì…˜

### ì™¸ë¶€ ì°¸ê³ 

- [Hugging Face Model Card](https://huggingface.co/sentence-transformers/paraphrase-multilingual-MiniLM-L12-v2)
- [sentence-transformers Documentation](https://www.sbert.net/)
- [ChromaDB Documentation](https://docs.trychroma.com/)

---

**Plan Version**: 1.0.0
**Last Updated**: 2025-01-17
**Status**: Ready for Phase 1 (data-model.md, quickstart.md)
**Next Command**: `/speckit.tasks` (Phase 2 - tasks.md ìƒì„±)
