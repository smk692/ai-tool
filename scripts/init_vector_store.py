#!/usr/bin/env python3
"""
ChromaDB ë²¡í„° ì €ì¥ì†Œ ì´ˆê¸°í™” ìŠ¤í¬ë¦½íŠ¸

ìƒ˜í”Œ ë¬¸ì„œë¥¼ ì„ë² ë”©í•˜ê³  ChromaDBì— ì €ì¥í•©ë‹ˆë‹¤.
"""

import sys
from pathlib import Path

# Add project root to path
project_root = Path(__file__).parent.parent
sys.path.insert(0, str(project_root))

from src.services.embedding import HuggingFaceEmbedding
from src.utils.logging import logger


# ìƒ˜í”Œ ë¬¸ì„œ ë°ì´í„° (í•œêµ­ì–´)
SAMPLE_DOCUMENTS = [
    {
        "id": "doc_001",
        "title": "íšŒì›ê°€ì… ê°€ì´ë“œ",
        "content": """íšŒì›ê°€ì… ì ˆì°¨ëŠ” ë‹¤ìŒê³¼ ê°™ìŠµë‹ˆë‹¤:

1. ì´ë©”ì¼ ì£¼ì†Œ ì…ë ¥
   - ìœ íš¨í•œ ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”
   - ì´ë©”ì¼ ì¤‘ë³µ í™•ì¸ì´ ì§„í–‰ë©ë‹ˆë‹¤

2. ë¹„ë°€ë²ˆí˜¸ ì„¤ì •
   - 8ì ì´ìƒ ì…ë ¥í•´ì£¼ì„¸ìš”
   - ì˜ë¬¸, ìˆ«ì, íŠ¹ìˆ˜ë¬¸ìë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤
   - ë¹„ë°€ë²ˆí˜¸ ê°•ë„ê°€ í‘œì‹œë©ë‹ˆë‹¤

3. ì´ë©”ì¼ ì¸ì¦
   - ì…ë ¥í•˜ì‹  ì´ë©”ì¼ë¡œ ì¸ì¦ ë©”ì¼ì´ ë°œì†¡ë©ë‹ˆë‹¤
   - ë©”ì¼ì˜ ì¸ì¦ ë§í¬ë¥¼ í´ë¦­í•´ì£¼ì„¸ìš”
   - ì¸ì¦ì€ 24ì‹œê°„ ì´ë‚´ì— ì™„ë£Œí•´ì•¼ í•©ë‹ˆë‹¤

4. í”„ë¡œí•„ ì •ë³´ ì…ë ¥
   - ì´ë¦„, ì „í™”ë²ˆí˜¸ ë“± ê¸°ë³¸ ì •ë³´ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤
   - ì„ íƒ ì‚¬í•­ì€ ë‚˜ì¤‘ì— ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤

5. ê°€ì… ì™„ë£Œ
   - ëª¨ë“  ì ˆì°¨ê°€ ì™„ë£Œë˜ë©´ ìë™ ë¡œê·¸ì¸ë©ë‹ˆë‹¤
   - í™˜ì˜ ë©”ì‹œì§€ì™€ í•¨ê»˜ ì„œë¹„ìŠ¤ë¥¼ ì´ìš©í•˜ì‹¤ ìˆ˜ ìˆìŠµë‹ˆë‹¤""",
        "category": "ê³„ì •ê´€ë¦¬",
    },
    {
        "id": "doc_002",
        "title": "ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ë°©ë²•",
        "content": """ë¹„ë°€ë²ˆí˜¸ë¥¼ ìŠì–´ë²„ë ¸ì„ ë•Œ ì¬ì„¤ì •í•˜ëŠ” ë°©ë²•:

1. ë¡œê·¸ì¸ í˜ì´ì§€ì—ì„œ 'ë¹„ë°€ë²ˆí˜¸ ì°¾ê¸°' í´ë¦­
   - ì´ë©”ì¼ ì£¼ì†Œë¥¼ ì…ë ¥í•©ë‹ˆë‹¤
   - ê°€ì… ì‹œ ì‚¬ìš©í•œ ì´ë©”ì¼ì„ ì…ë ¥í•´ì£¼ì„¸ìš”

2. ì´ë©”ì¼ í™•ì¸
   - ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • ë§í¬ê°€ í¬í•¨ëœ ë©”ì¼ì´ ë°œì†¡ë©ë‹ˆë‹¤
   - ë©”ì¼ì´ ì˜¤ì§€ ì•Šìœ¼ë©´ ìŠ¤íŒ¸í•¨ì„ í™•ì¸í•´ì£¼ì„¸ìš”

3. ìƒˆ ë¹„ë°€ë²ˆí˜¸ ì„¤ì •
   - ë©”ì¼ì˜ ë§í¬ë¥¼ í´ë¦­í•˜ë©´ ë¹„ë°€ë²ˆí˜¸ ì¬ì„¤ì • í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤
   - ìƒˆë¡œìš´ ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤
   - ë¹„ë°€ë²ˆí˜¸ í™•ì¸ì„ ìœ„í•´ í•œ ë²ˆ ë” ì…ë ¥í•©ë‹ˆë‹¤

4. ì¬ì„¤ì • ì™„ë£Œ
   - ìƒˆ ë¹„ë°€ë²ˆí˜¸ë¡œ ë¡œê·¸ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
   - ë³´ì•ˆì„ ìœ„í•´ ì£¼ê¸°ì ìœ¼ë¡œ ë¹„ë°€ë²ˆí˜¸ë¥¼ ë³€ê²½í•˜ëŠ” ê²ƒì„ ê¶Œì¥í•©ë‹ˆë‹¤

ì£¼ì˜ì‚¬í•­:
- ì¬ì„¤ì • ë§í¬ëŠ” 1ì‹œê°„ ë™ì•ˆë§Œ ìœ íš¨í•©ë‹ˆë‹¤
- ë§í¬ê°€ ë§Œë£Œë˜ë©´ ì²˜ìŒë¶€í„° ë‹¤ì‹œ ì§„í–‰í•´ì•¼ í•©ë‹ˆë‹¤""",
        "category": "ê³„ì •ê´€ë¦¬",
    },
    {
        "id": "doc_003",
        "title": "ì£¼ë¬¸ ë° ê²°ì œ ê°€ì´ë“œ",
        "content": """ìƒí’ˆ ì£¼ë¬¸ ë° ê²°ì œ ë°©ë²•:

1. ìƒí’ˆ ì„ íƒ
   - ì›í•˜ëŠ” ìƒí’ˆì„ ì°¾ì•„ ìƒì„¸ í˜ì´ì§€ë¡œ ì´ë™í•©ë‹ˆë‹¤
   - ì˜µì…˜(ìƒ‰ìƒ, í¬ê¸° ë“±)ì„ ì„ íƒí•©ë‹ˆë‹¤
   - ìˆ˜ëŸ‰ì„ ì…ë ¥í•˜ê³  'ì¥ë°”êµ¬ë‹ˆ ë‹´ê¸°' ë˜ëŠ” 'ë°”ë¡œ êµ¬ë§¤' í´ë¦­

2. ì¥ë°”êµ¬ë‹ˆ í™•ì¸
   - ì¥ë°”êµ¬ë‹ˆì—ì„œ ì£¼ë¬¸í•  ìƒí’ˆì„ í™•ì¸í•©ë‹ˆë‹¤
   - í•„ìš”ì‹œ ìˆ˜ëŸ‰ ì¡°ì •ì´ë‚˜ ì‚­ì œê°€ ê°€ëŠ¥í•©ë‹ˆë‹¤
   - ì¿ í°ì´ë‚˜ ì ë¦½ê¸ˆ ì‚¬ìš© ì—¬ë¶€ë¥¼ ì„ íƒí•©ë‹ˆë‹¤

3. ë°°ì†¡ì§€ ì •ë³´ ì…ë ¥
   - ë°›ìœ¼ì‹œëŠ” ë¶„ ì •ë³´ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤
   - ë°°ì†¡ ì£¼ì†Œë¥¼ ì…ë ¥í•©ë‹ˆë‹¤
   - ë°°ì†¡ ë©”ì‹œì§€ë¥¼ ì‘ì„±í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤

4. ê²°ì œ ìˆ˜ë‹¨ ì„ íƒ
   - ì‹ ìš©ì¹´ë“œ, ê³„ì¢Œì´ì²´, ë¬´í†µì¥ì…ê¸ˆ ì¤‘ ì„ íƒ
   - ì¹´ë“œ ê²°ì œ ì‹œ í• ë¶€ ê°œì›” ìˆ˜ ì„ íƒ ê°€ëŠ¥
   - ê²°ì œ ì •ë³´ë¥¼ ì…ë ¥í•©ë‹ˆë‹¤

5. ì£¼ë¬¸ ì™„ë£Œ
   - ì£¼ë¬¸ ë‚´ì—­ì„ ìµœì¢… í™•ì¸í•©ë‹ˆë‹¤
   - 'ê²°ì œí•˜ê¸°' ë²„íŠ¼ì„ í´ë¦­í•©ë‹ˆë‹¤
   - ì£¼ë¬¸ ì™„ë£Œ ë©”ì‹œì§€ì™€ ì£¼ë¬¸ë²ˆí˜¸ê°€ í‘œì‹œë©ë‹ˆë‹¤

ë°°ì†¡ ì¡°íšŒ:
- ë§ˆì´í˜ì´ì§€ > ì£¼ë¬¸ë‚´ì—­ì—ì„œ ë°°ì†¡ í˜„í™©ì„ í™•ì¸í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤
- ë°°ì†¡ ì‹œì‘ ì‹œ ì†¡ì¥ë²ˆí˜¸ê°€ ë°œì†¡ë©ë‹ˆë‹¤""",
        "category": "ì£¼ë¬¸/ê²°ì œ",
    },
    {
        "id": "doc_004",
        "title": "ë°˜í’ˆ ë° êµí™˜ ì •ì±…",
        "content": """ë°˜í’ˆ ë° êµí™˜ ì•ˆë‚´:

ë°˜í’ˆ ê°€ëŠ¥ ê¸°ê°„:
- ìƒí’ˆ ìˆ˜ë ¹ í›„ 7ì¼ ì´ë‚´
- ë‹¨ìˆœ ë³€ì‹¬ì˜ ê²½ìš°ë„ ê°€ëŠ¥í•©ë‹ˆë‹¤
- ìƒí’ˆì˜ íƒœê·¸ë‚˜ ë¼ë²¨ì´ í›¼ì†ë˜ì§€ ì•Šì•„ì•¼ í•©ë‹ˆë‹¤

ë°˜í’ˆ ë¶ˆê°€ ì‚¬í•­:
- ì‚¬ìš©í•˜ê±°ë‚˜ ì°©ìš©í•œ ìƒí’ˆ
- ì„¸íƒí•˜ê±°ë‚˜ ìˆ˜ì„ í•œ ìƒí’ˆ
- ìƒí’ˆ íƒì´ë‚˜ ë¼ë²¨ì„ ì œê±°í•œ ê²½ìš°
- ê³ ê° ê³¼ì‹¤ë¡œ ìƒí’ˆì´ í›¼ì†ëœ ê²½ìš°

ë°˜í’ˆ ì ˆì°¨:
1. ë§ˆì´í˜ì´ì§€ > ì£¼ë¬¸ë‚´ì—­ì—ì„œ ë°˜í’ˆ ì‹ ì²­
2. ë°˜í’ˆ ì‚¬ìœ  ì„ íƒ ë° ìƒì„¸ ë‚´ìš© ì‘ì„±
3. ìˆ˜ê±° ì‹ ì²­ ë˜ëŠ” ì§ì ‘ ë°œì†¡
4. ìƒí’ˆ í™•ì¸ í›„ í™˜ë¶ˆ ì²˜ë¦¬

êµí™˜ ì ˆì°¨:
1. ë§ˆì´í˜ì´ì§€ > ì£¼ë¬¸ë‚´ì—­ì—ì„œ êµí™˜ ì‹ ì²­
2. êµí™˜ ì‚¬ìœ  ë° ì›í•˜ëŠ” ì˜µì…˜ ì„ íƒ
3. ìƒí’ˆ íšŒìˆ˜ ë° êµí™˜ ìƒí’ˆ ë°œì†¡
4. êµí™˜ ì™„ë£Œ

í™˜ë¶ˆ ì•ˆë‚´:
- ì¹´ë“œ ê²°ì œ: ìŠ¹ì¸ ì·¨ì†Œ (3-5ì˜ì—…ì¼)
- ê³„ì¢Œì´ì²´: í™˜ë¶ˆ ê³„ì¢Œë¡œ ì…ê¸ˆ (2-3ì˜ì—…ì¼)
- ë°°ì†¡ë¹„ëŠ” ê·€ì±… ì‚¬ìœ ì— ë”°ë¼ ë¶€ë‹´ìê°€ ê²°ì •ë©ë‹ˆë‹¤""",
        "category": "ë°˜í’ˆ/êµí™˜",
    },
    {
        "id": "doc_005",
        "title": "ê³ ê°ì„¼í„° ì´ìš© ì•ˆë‚´",
        "content": """ê³ ê°ì„¼í„° ë¬¸ì˜ ë°©ë²•:

ìš´ì˜ ì‹œê°„:
- í‰ì¼: 09:00 - 18:00
- ì ì‹¬ì‹œê°„: 12:00 - 13:00
- ì£¼ë§ ë° ê³µíœ´ì¼ íœ´ë¬´

ë¬¸ì˜ ë°©ë²•:

1. ì „í™” ë¬¸ì˜
   - ê³ ê°ì„¼í„°: 1588-XXXX
   - ìƒë‹´ì› ì—°ê²°ê¹Œì§€ í‰ê·  3-5ë¶„ ì†Œìš”
   - ì£¼ë¬¸ë²ˆí˜¸ë¥¼ ë¯¸ë¦¬ ì¤€ë¹„í•˜ì‹œë©´ ë¹ ë¥¸ ìƒë‹´ì´ ê°€ëŠ¥í•©ë‹ˆë‹¤

2. ì´ë©”ì¼ ë¬¸ì˜
   - support@company.com
   - 24ì‹œê°„ ì ‘ìˆ˜ ê°€ëŠ¥
   - í‰ì¼ ê¸°ì¤€ 24ì‹œê°„ ì´ë‚´ ë‹µë³€

3. 1:1 ë¬¸ì˜
   - ë§ˆì´í˜ì´ì§€ > 1:1 ë¬¸ì˜í•˜ê¸°
   - ë¬¸ì˜ ìœ í˜• ì„ íƒ ë° ë‚´ìš© ì‘ì„±
   - ì²¨ë¶€ íŒŒì¼ ë“±ë¡ ê°€ëŠ¥ (ìµœëŒ€ 10MB)
   - í‰ê·  2-3ì‹œê°„ ì´ë‚´ ë‹µë³€

4. ì±„íŒ… ìƒë‹´
   - ì›¹ì‚¬ì´íŠ¸ ìš°ì¸¡ í•˜ë‹¨ ì±„íŒ… ë²„íŠ¼
   - ì‹¤ì‹œê°„ ìƒë‹´ì› ì—°ê²°
   - ìš´ì˜ ì‹œê°„ ë‚´ ì¦‰ì‹œ ì‘ëŒ€

ìì£¼ ë¬»ëŠ” ì§ˆë¬¸(FAQ):
- íšŒì›ê°€ì…, ë¡œê·¸ì¸
- ì£¼ë¬¸/ê²°ì œ
- ë°°ì†¡
- ë°˜í’ˆ/êµí™˜
- ì ë¦½ê¸ˆ/ì¿ í°

FAQì—ì„œ ë‹µë³€ì„ ì°¾ì§€ ëª»í•œ ê²½ìš° ìœ„ ë°©ë²•ìœ¼ë¡œ ë¬¸ì˜í•´ì£¼ì„¸ìš”.""",
        "category": "ê³ ê°ì§€ì›",
    },
]


def main():
    """ë²¡í„° ì €ì¥ì†Œ ì´ˆê¸°í™” ë° ìƒ˜í”Œ ë°ì´í„° ì„ë² ë”©"""
    print("=" * 80)
    print(" ChromaDB Vector Store Initialization")
    print("=" * 80)
    print()

    try:
        # Initialize embedding service
        print("ğŸ”„ Initializing Hugging Face embedding service...")
        embedding_service = HuggingFaceEmbedding()
        print(
            f"âœ… Embedding service initialized: {embedding_service.model_name} "
            f"({embedding_service.embedding_dim} dimensions)\n"
        )

        # Prepare documents
        texts = [doc["content"] for doc in SAMPLE_DOCUMENTS]
        ids = [doc["id"] for doc in SAMPLE_DOCUMENTS]
        metadatas = [
            {"title": doc["title"], "category": doc["category"]}
            for doc in SAMPLE_DOCUMENTS
        ]

        print(f"ğŸ“„ Preparing {len(texts)} documents for embedding...")
        print()

        # Add documents to vector store
        print("ğŸ”„ Embedding and storing documents in ChromaDB...")
        embedding_service.vector_store.add_documents(
            texts=texts, ids=ids, metadatas=metadatas
        )

        print(f"âœ… Successfully embedded {len(texts)} documents!\n")

        # Verify by performing a test search
        print("-" * 80)
        print(" Testing Vector Search")
        print("-" * 80)
        print()

        test_queries = [
            "íšŒì›ê°€ì…í•˜ëŠ” ë°©ë²•ì„ ì•Œë ¤ì£¼ì„¸ìš”",
            "ë¹„ë°€ë²ˆí˜¸ë¥¼ ìŠì–´ë²„ë ¸ì–´ìš”",
            "ì£¼ë¬¸í•œ ìƒí’ˆì„ ë°˜í’ˆí•˜ê³  ì‹¶ì–´ìš”",
        ]

        for i, query in enumerate(test_queries, 1):
            print(f"Test {i}: {query}")
            results = embedding_service.search(query_text=query, top_k=2)

            if results and results.get("documents") and results["documents"][0]:
                print(f"  Found {len(results['documents'][0])} relevant documents:")
                for j, (doc_id, metadata) in enumerate(
                    zip(results["ids"][0], results["metadatas"][0]), 1
                ):
                    title = metadata.get("title", "Unknown")
                    category = metadata.get("category", "Unknown")
                    distance = results["distances"][0][j - 1] if results.get("distances") else 0.0
                    similarity = 1.0 - distance  # Convert distance to similarity
                    print(
                        f"    {j}. {title} ({category}) - similarity: {similarity:.2f}"
                    )
            else:
                print("  âš ï¸ No documents found")
            print()

        print("=" * 80)
        print(" Initialization Complete!")
        print("=" * 80)
        print()
        print("Next steps:")
        print("1. Run: python scripts/test_claude_connection.py")
        print("2. Run: python scripts/example_usage.py")
        print("3. Check: Browse data/chroma/ directory for persisted embeddings")
        print()

    except Exception as e:
        logger.error(f"Failed to initialize vector store: {e}")
        print(f"âŒ Error: {e}\n")
        raise


if __name__ == "__main__":
    main()
