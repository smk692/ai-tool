# ì‹œìŠ¤í…œ ì•„í‚¤í…ì²˜ (ì˜¤í”ˆì†ŒìŠ¤ ê¸°ë°˜)

## ğŸ—ï¸ ì „ì²´ ì•„í‚¤í…ì²˜ ê°œìš”

### ë©€í‹° ì—ì´ì „íŠ¸ ì•„í‚¤í…ì²˜

```mermaid
graph TB
    UI[ì‚¬ìš©ì ì¸í„°í˜ì´ìŠ¤: Streamlit/Gradio]

    Router[Router Supervisor Chain]
    Evaluator[ì§ˆë¬¸ í‰ê°€ê¸°]
    Classifier[ì§ˆë¬¸ ë¶„ë¥˜ê¸°]
    Reformulator[ì§ˆë¬¸ ì¬êµ¬ì„±ê¸°]

    Agent1[Text-to-SQL Chain]
    Agent2[Data Discovery Chain]
    Agent3[Knowledge Discovery Chain]
    Agent4[Memory Management]
    Agent5[Support Automation]

    RAG[RAG System: ChromaDB + BM25s]
    React[Agentic Workflow: ReAct]
    Memory[(Memory Store: SQLite)]

    LLM[LLM API: OpenAI GPT-4o]
    DB[(PostgreSQL Database)]
    VectorDB[(ChromaDB Vector Store)]

    Logging[Logging System]
    Tracing[Tracing: JSON]

    UI --> Router
    Router --> Evaluator
    Router --> Classifier
    Router --> Reformulator

    Router --> Agent1
    Router --> Agent2
    Router --> Agent3
    Router --> Agent4
    Router --> Agent5

    Agent1 --> RAG
    Agent2 --> RAG
    Agent3 --> RAG
    Agent1 --> React
    Agent3 --> React

    RAG --> VectorDB
    RAG --> LLM
    React --> LLM

    Agent1 --> DB
    Agent4 --> Memory

    Agent1 --> Logging
    Agent2 --> Logging
    Agent3 --> Logging
    React --> Tracing

    style UI fill:#e1f5ff
    style Router fill:#fff4e1
    style RAG fill:#f3e5f5
    style LLM fill:#ffebee
    style DB fill:#e8f5e9
    style VectorDB fill:#e8f5e9
```

---

## ğŸ”§ í•µì‹¬ ì»´í¬ë„ŒíŠ¸ ì•„í‚¤í…ì²˜

### 1. Router Supervisor Chain

```mermaid
flowchart TD
    Start([ì‚¬ìš©ì ì§ˆë¬¸])
    Evaluate[ì§ˆë¬¸ í‰ê°€]
    Extract[ë¹„ì¦ˆë‹ˆìŠ¤ ìš©ì–´ ì¶”ì¶œ]
    Classify{ì§ˆë¬¸ ìœ í˜• ë¶„ë¥˜}

    SQL[Text-to-SQL Chain]
    Discovery[Data Discovery Chain]
    Knowledge[Knowledge Discovery Chain]
    General[General Chat Chain]

    Format[ì§ˆë¬¸ ì¬êµ¬ì„±]
    Chain[ì²´ì¸ ì‹¤í–‰]

    Start --> Evaluate
    Evaluate --> Extract
    Extract --> Classify

    Classify -->|SQL ì¿¼ë¦¬| SQL
    Classify -->|ë°ì´í„° íƒìƒ‰| Discovery
    Classify -->|ì§€ì‹ ê²€ìƒ‰| Knowledge
    Classify -->|ì¼ë°˜ ëŒ€í™”| General

    SQL --> Format
    Discovery --> Format
    Knowledge --> Format

    Format --> Chain

    style Start fill:#e1f5ff
    style Classify fill:#fff4e1
    style Format fill:#f3e5f5
```

### 2. RAG System êµ¬ì¡°

```mermaid
graph TB
    Meta[í…Œì´ë¸” ë©”íƒ€ë°ì´í„°]
    DDL[DDL ìŠ¤í‚¤ë§ˆ]
    FewShot[Few-shot ì˜ˆì œ]
    Docs[ì‚¬ë‚´ ë¬¸ì„œ]

    Embed[sentence-transformers ë¡œì»¬ ì‹¤í–‰]

    Meta --> Embed
    DDL --> Embed
    FewShot --> Embed
    Docs --> Embed

    Chroma[(ChromaDB ë²¡í„° ì €ì¥ì†Œ)]
    Embed --> Chroma

    BM25[BM25 í‚¤ì›Œë“œ ê²€ìƒ‰]
    Vector[ë²¡í„° ìœ ì‚¬ë„ ê²€ìƒ‰]

    Query([ê²€ìƒ‰ ì¿¼ë¦¬])
    Query --> BM25
    Query --> Vector

    Chroma --> Vector

    Hybrid[Hybrid Search: 0.5 BM25 + 0.5 Vector]
    BM25 --> Hybrid
    Vector --> Hybrid

    Results([ê²€ìƒ‰ ê²°ê³¼])
    Hybrid --> Results

    style Query fill:#e1f5ff
    style Embed fill:#fff4e1
    style Hybrid fill:#f3e5f5
    style Results fill:#e8f5e9
```

### 3. Text-to-SQL í”Œë¡œìš°

```mermaid
sequenceDiagram
    participant User as ì‚¬ìš©ì
    participant Router as Router
    participant Search as RAG
    participant LLM as GPT-4o
    participant DB as PostgreSQL
    participant Val as SQLê²€ì¦ê¸°

    User->>Router: ì§€ë‚œë‹¬ ì‹ ê·œ ê°€ì…ì ìˆ˜ëŠ”?
    Router->>Router: ì§ˆë¬¸ ë¶„ë¥˜
    Router->>Search: ìš©ì–´ ê²€ìƒ‰
    Search-->>Router: users í…Œì´ë¸”

    Router->>Search: DDL ì¡°íšŒ
    Search-->>Router: users DDL

    Router->>Search: Few-shot ê²€ìƒ‰
    Search-->>Router: ìœ ì‚¬ ì¿¼ë¦¬ 2ê°œ

    Router->>LLM: í”„ë¡¬í”„íŠ¸ ì „ì†¡
    LLM-->>Router: SQL ìƒì„±

    Router->>Val: SQL ê²€ì¦
    Val->>DB: EXPLAIN ì‹¤í–‰
    DB-->>Val: ë¬¸ë²• OK
    Val-->>Router: ê²€ì¦ ì™„ë£Œ

    Router->>User: SQL ì¿¼ë¦¬ + ì„¤ëª…
```

### 4. Knowledge Discovery í”Œë¡œìš°

```mermaid
flowchart TD
    Question([ì‚¬ìš©ì ì§ˆë¬¸])
    Router[Router Supervisor]
    Classify{ì§ˆë¬¸ ìœ í˜•}

    Search[í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰]
    BM25[BM25 í‚¤ì›Œë“œ]
    Vector[ë²¡í„° ìœ ì‚¬ë„]

    Combine[ê²°ê³¼ í†µí•©]
    Results[ê²€ìƒ‰ ê²°ê³¼ 3ê°œ]

    Extract[ë¬¸ì„œ ë‚´ìš© ì¶”ì¶œ]
    OCR{ì´ë¯¸ì§€ í¬í•¨?}

    ImageText[ì´ë¯¸ì§€ OCR]
    TextOnly[í…ìŠ¤íŠ¸ë§Œ]

    ReAct[ReAct ì—ì´ì „íŠ¸]

    Think1[Thought: ì ˆì°¨ ì°¾ê¸°]
    Action1[Action: SearchKnowledge]
    Obs1[Observation: 3ê°œ ë°œê²¬]

    Think2[Thought: ìµœì‹  ì •ë³´ í™•ì¸]
    Action2[Action: ConfluenceAPI]
    Obs2[Observation: ìµœì‹  ê°€ì´ë“œ]

    Think3[Thought: ë‹µë³€ ì¤€ë¹„]
    LLM[LLM ë‹µë³€ ìƒì„±]
    Answer([ìµœì¢… ë‹µë³€])

    Question --> Router
    Router --> Classify
    Classify -->|ì§€ì‹ ê²€ìƒ‰| Search

    Search --> BM25
    Search --> Vector
    BM25 --> Combine
    Vector --> Combine

    Combine --> Results
    Results --> Extract
    Extract --> OCR

    OCR -->|Yes| ImageText
    OCR -->|No| TextOnly

    ImageText --> ReAct
    TextOnly --> ReAct

    ReAct --> Think1
    Think1 --> Action1
    Action1 --> Obs1

    Obs1 --> Think2
    Think2 --> Action2
    Action2 --> Obs2

    Obs2 --> Think3
    Think3 --> LLM
    LLM --> Answer

    style Question fill:#e1f5ff
    style Classify fill:#fff4e1
    style Combine fill:#f3e5f5
    style ReAct fill:#ffebee
    style Answer fill:#e8f5e9
```

### 5. Memory Management

```mermaid
graph LR
    Q1[ì§ˆë¬¸ 1: users í…Œì´ë¸”ì€?]
    A1[ë‹µë³€ 1: ì‚¬ìš©ì ì •ë³´ ì €ì¥]
    Q2[ì§ˆë¬¸ 2: ê±°ê¸°ì„œ ê°€ì…ì ìˆ˜ëŠ”?]

    DB[(conversations.db)]
    Session[session_id: abc123]
    Msg1[msg_1: Q1 + A1]
    Msg2[msg_2: Q2]

    Load[ìµœê·¼ Nê°œ ëŒ€í™” ë¡œë“œ]
    Rewrite[ì§ˆë¬¸ ì¬êµ¬ì„±]
    Context[ì¬êµ¬ì„±ëœ ì§ˆë¬¸]
    Process[ì§ˆë¬¸ ì²˜ë¦¬]

    Q1 --> DB
    A1 --> DB
    Q2 --> DB

    DB --> Session
    Session --> Msg1
    Session --> Msg2

    Q2 --> Load
    DB --> Load
    Load --> Rewrite
    Rewrite --> Context
    Context --> Process

    style DB fill:#e8f5e9
    style Context fill:#fff4e1
    style Process fill:#f3e5f5
```

### 6. ReAct Workflow

```mermaid
stateDiagram-v2
    [*] --> Thought1: ì§ˆë¬¸ ë°›ìŒ

    Thought1: Thought ìƒí™© ë¶„ì„
    Action1: Action ë„êµ¬ ì‹¤í–‰
    Observation1: Observation ê²°ê³¼ í‰ê°€

    Thought2: Thought ì¶”ê°€ ì •ë³´ í•„ìš”
    Action2: Action ì¶”ê°€ ë„êµ¬
    Observation2: Observation ê²°ê³¼ ì¢…í•©

    Thought3: Thought ë‹µë³€ ì¤€ë¹„
    FinalAnswer: Final Answer

    Thought1 --> Action1
    Action1 --> Observation1

    Observation1 --> Thought2: ë¯¸ë‹¬ì„±
    Observation1 --> FinalAnswer: ë‹¬ì„±

    Thought2 --> Action2
    Action2 --> Observation2

    Observation2 --> Thought3: ì¶©ë¶„
    Observation2 --> Thought1: ë¶€ì¡±

    Thought3 --> FinalAnswer
    FinalAnswer --> [*]
```

---

## ğŸ“Š ë°ì´í„° í”Œë¡œìš°

### Text-to-SQL ì „ì²´ í”Œë¡œìš°

```mermaid
flowchart TD
    Start([ì‚¬ìš©ì ì§ˆë¬¸])

    Router[Router Supervisor]
    Eval[ì§ˆë¬¸ í‰ê°€]
    Class[ë¶„ë¥˜: text_to_sql]

    Terms[ë¹„ì¦ˆë‹ˆìŠ¤ ìš©ì–´ ê²€ìƒ‰]
    Map[ë§¤í•‘: ìš©ì–´-í…Œì´ë¸”]

    Search1[í…Œì´ë¸” ê²€ìƒ‰]
    Meta[ë©”íƒ€ë°ì´í„° ì¡°íšŒ]
    DDL[DDL ì¶•ì†Œ]
    FewShot[Few-shot ê²€ìƒ‰]

    Prompt[í”„ë¡¬í”„íŠ¸ êµ¬ì„±]
    LLM[GPT-4o API]
    SQL[ìƒì„±ëœ SQL]

    Validate[SQL ê²€ì¦]
    Check{ë¬¸ë²• OK?}
    Format[ê²°ê³¼ í¬ë§·íŒ…]
    Fix[ì˜¤ë¥˜ ìˆ˜ì •]
    Result[ì‚¬ìš©ìì—ê²Œ ì „ë‹¬]

    Feedback{í”¼ë“œë°±}
    Log1[ê¸ì • ë¡œê·¸]
    Log2[ë¶€ì • ë¡œê·¸]

    Start --> Router
    Router --> Eval
    Eval --> Class

    Class --> Terms
    Terms --> Map

    Map --> Search1
    Search1 --> Meta
    Meta --> DDL
    DDL --> FewShot

    FewShot --> Prompt
    Prompt --> LLM
    LLM --> SQL

    SQL --> Validate
    Validate --> Check
    Check -->|Yes| Format
    Check -->|No| Fix
    Fix --> LLM

    Format --> Result
    Result --> Feedback
    Feedback -->|ê¸ì •| Log1
    Feedback -->|ë¶€ì •| Log2

    style Start fill:#e1f5ff
    style Router fill:#fff4e1
    style LLM fill:#ffebee
    style Result fill:#e8f5e9
```

### Knowledge Discovery ì „ì²´ í”Œë¡œìš°

```mermaid
flowchart TD
    Start([ì‚¬ìš©ì ì§ˆë¬¸])
    Router[Router]
    Classify{ë¶„ë¥˜}
    KD[Knowledge Discovery]

    Parallel{ë³‘ë ¬ ê²€ìƒ‰}
    BM25[BM25 í‚¤ì›Œë“œ]
    Vector[ë²¡í„° ìœ ì‚¬ë„]

    Combine[ì ìˆ˜ í†µí•©]
    Rank[ìƒìœ„ Kê°œ ì„ íƒ]
    Docs[ë¬¸ì„œ 3ê°œ]
    Extract[ë‚´ìš© ì¶”ì¶œ]

    T1[Thought: ì ˆì°¨ ì°¾ê¸°]
    A1[Action: SearchKnowledge]
    O1[Observation: 3ê°œ ë°œê²¬]

    T2[Thought: ìµœì‹  ì •ë³´]
    A2[Action: ConfluenceAPI]
    O2[Observation: ìµœì‹  ê°€ì´ë“œ]

    T3[Thought: ë‹µë³€ ìƒì„±]
    LLM[GPT-4o ìƒì„±]
    Answer[ìµœì¢… ë‹µë³€]
    User([ì‚¬ìš©ì ì „ë‹¬])

    Start --> Router
    Router --> Classify
    Classify -->|ì§€ì‹ê²€ìƒ‰| KD
    KD --> Parallel

    Parallel --> BM25
    Parallel --> Vector
    BM25 --> Combine
    Vector --> Combine

    Combine --> Rank
    Rank --> Docs
    Docs --> Extract

    Extract --> T1
    T1 --> A1
    A1 --> O1

    O1 --> T2
    T2 --> A2
    A2 --> O2

    O2 --> T3
    T3 --> LLM
    LLM --> Answer
    Answer --> User

    style Start fill:#e1f5ff
    style Classify fill:#fff4e1
    style Combine fill:#f3e5f5
    style LLM fill:#ffebee
    style User fill:#e8f5e9
```

---

## ğŸ’¾ ë°ì´í„° ì €ì¥ êµ¬ì¡°

### ChromaDB ì»¬ë ‰ì…˜

```mermaid
graph TB
    Root[chromadb_data]

    Col1[table_metadata]
    Col2[table_ddl]
    Col3[sql_examples]
    Col4[knowledge_base]

    Embed1[embeddings]
    Doc1[documents]

    Embed2[embeddings]
    Doc2[documents]

    Embed3[embeddings]
    Doc3[documents]

    Embed4[embeddings]
    Doc4[documents]

    Root --> Col1
    Root --> Col2
    Root --> Col3
    Root --> Col4

    Col1 --> Embed1
    Col1 --> Doc1

    Col2 --> Embed2
    Col2 --> Doc2

    Col3 --> Embed3
    Col3 --> Doc3

    Col4 --> Embed4
    Col4 --> Doc4

    style Root fill:#e1f5ff
    style Col1 fill:#fff4e1
    style Col2 fill:#f3e5f5
    style Col3 fill:#ffebee
    style Col4 fill:#e8f5e9
```

### SQLite DB êµ¬ì¡°

```mermaid
erDiagram
    TABLE_METADATA {
        string table_name PK
        string description
        string purpose
        string columns_json
        datetime updated_at
    }

    COLUMN_META {
        int id PK
        string table_name FK
        string column_name
        string data_type
        string description
    }

    BUSINESS_TERMS {
        int id PK
        string term
        string definition
        string related_tables
    }

    FEWSHOT_EXAMPLES {
        int id PK
        string question
        string sql_query
        string table_names
    }

    CONVERSATIONS {
        int id PK
        string session_id
        datetime timestamp
        string role
        string content
    }

    SESSIONS {
        string session_id PK
        string user_id
        datetime started_at
    }

    FEEDBACK {
        int id PK
        string session_id FK
        int message_id
        string feedback_type
    }

    TABLE_METADATA ||--o{ COLUMN_META : has
    CONVERSATIONS }o--|| SESSIONS : belongs_to
    CONVERSATIONS ||--o{ FEEDBACK : has
```

---

## ğŸ”§ ê¸°ìˆ  ìŠ¤íƒ ë§µí•‘

```mermaid
graph LR
    UI1[Streamlit]
    UI2[Gradio]

    LC[LangChain]
    LG[LangGraph]

    GPT[OpenAI GPT-4o ìœ ë£Œ]
    ST[sentence-transformers]

    Chroma[ChromaDB]
    PG[PostgreSQL]
    SQ[SQLite]

    BM25[rank-bm25]

    PDF[PyPDF2]
    DOCX[python-docx]
    OCR[pytesseract]

    UI1 --> LC
    UI2 --> LC
    LC --> LG
    LG --> GPT
    LC --> ST
    LC --> Chroma
    LC --> PG
    LC --> SQ
    LC --> BM25
    LC --> PDF
    LC --> DOCX
    LC --> OCR

    style GPT fill:#ffebee
    style UI1 fill:#e1f5ff
    style UI2 fill:#e1f5ff
    style Chroma fill:#e8f5e9
    style PG fill:#e8f5e9
    style SQ fill:#e8f5e9
```

---

## ğŸš€ ë°°í¬ ì•„í‚¤í…ì²˜

### ë¡œì»¬ ê°œë°œ

```mermaid
graph TB
    Python[Python 3.10+]

    App[Streamlit App]
    LangChain[LangChain/Graph]

    ChromaLocal[ChromaDB ë¡œì»¬]
    PostgresLocal[PostgreSQL ë¡œì»¬]
    SQLiteLocal[SQLite ë¡œì»¬]

    Embeddings[sentence-transformers]
    API[OpenAI API]

    Python --> App
    App --> LangChain
    LangChain --> ChromaLocal
    LangChain --> PostgresLocal
    LangChain --> SQLiteLocal
    LangChain --> Embeddings
    LangChain --> API

    style Python fill:#e1f5ff
    style API fill:#ffebee
```

### Docker Compose ë°°í¬

```mermaid
graph TB
    User([ì‚¬ìš©ì])

    Streamlit[Streamlit Container :8501]
    App[App Container :8000]
    Postgres[PostgreSQL Container :5432]

    ChromaDB[ChromaDB Volume]
    Vol1[chromadb_data]
    Vol2[postgres_data]
    Vol3[sqlite_data]

    External[OpenAI API External]

    User --> Streamlit
    Streamlit --> App
    App --> ChromaDB
    App --> Postgres
    ChromaDB --> Vol1
    Postgres --> Vol2
    App --> Vol3
    App --> External

    style User fill:#e1f5ff
    style External fill:#ffebee
    style Vol1 fill:#e8f5e9
    style Vol2 fill:#e8f5e9
    style Vol3 fill:#e8f5e9
```

---

## ğŸ“Š ì„±ëŠ¥ ìµœì í™”

### ìºì‹± ì „ëµ

```mermaid
flowchart TD
    Query([ì‚¬ìš©ì ì§ˆë¬¸])
    Cache{ìºì‹œ í™•ì¸}

    CacheResult[ìºì‹œëœ ê²°ê³¼ ë°˜í™˜]
    Process[ì§ˆë¬¸ ì²˜ë¦¬]

    LLM[LLM API í˜¸ì¶œ]
    Result[ê²°ê³¼ ìƒì„±]

    SaveCache[ìºì‹œ ì €ì¥ SQLite]
    Return[ê²°ê³¼ ë°˜í™˜]

    Hash[ì§ˆë¬¸ í•´ì‹œí™”]
    Key[ìºì‹œ í‚¤ ìƒì„±]

    Query --> Hash
    Hash --> Key
    Key --> Cache

    Cache -->|Hit| CacheResult
    Cache -->|Miss| Process

    Process --> LLM
    LLM --> Result
    Result --> SaveCache
    SaveCache --> Return

    CacheResult --> Return

    style Cache fill:#fff4e1
    style CacheResult fill:#e8f5e9
    style LLM fill:#ffebee
```

### BM25 ì‚¬ì „ ê³„ì‚°

```mermaid
graph LR
    Corpus[ë¬¸ì„œ ì½”í¼ìŠ¤]
    Tokenize[í† í°í™”]
    BuildIndex[BM25 ì¸ë±ìŠ¤ êµ¬ì¶•]
    Save[ì¸ë±ìŠ¤ ì €ì¥ pickle]

    LoadIndex[ì¸ë±ìŠ¤ ë¡œë“œ]
    Query[ê²€ìƒ‰ ì¿¼ë¦¬]
    Score[ì ìˆ˜ ê³„ì‚°]
    Results[ê²€ìƒ‰ ê²°ê³¼ 0.1-1ms]

    Corpus --> Tokenize
    Tokenize --> BuildIndex
    BuildIndex --> Save

    Save -.->|ì €ì¥| LoadIndex

    LoadIndex --> Query
    Query --> Score
    Score --> Results

    style BuildIndex fill:#fff4e1
    style Results fill:#e8f5e9
```

---

## ğŸ“ êµ¬í˜„ ê°€ì´ë“œ

### í•µì‹¬ ì½”ë“œ ì˜ˆì‹œ

#### 1. ChromaDB ì„¤ì •

```python
import chromadb
from chromadb.config import Settings

# ë¡œì»¬ ì˜êµ¬ ì €ì¥ì†Œ
client = chromadb.Client(Settings(
    chroma_db_impl="duckdb+parquet",
    persist_directory="./chromadb_data"
))

# ì»¬ë ‰ì…˜ ìƒì„±
metadata_collection = client.create_collection(
    name="table_metadata"
)
```

#### 2. ë¡œì»¬ ì„ë² ë”©

```python
from sentence_transformers import SentenceTransformer

# ë‹¤êµ­ì–´ ëª¨ë¸ (í•œêµ­ì–´ ì§€ì›)
model = SentenceTransformer('paraphrase-multilingual-MiniLM-L12-v2')

# ì„ë² ë”© ìƒì„±
def embed_text(text):
    return model.encode(text).tolist()
```

#### 3. í•˜ì´ë¸Œë¦¬ë“œ ê²€ìƒ‰

```python
from rank_bm25 import BM25Okapi
import numpy as np

def hybrid_search(query, top_k=5, alpha=0.5):
    # BM25 ê²€ìƒ‰
    bm25_scores = bm25.get_scores(query.split())

    # ë²¡í„° ê²€ìƒ‰
    vector_results = collection.query(
        query_embeddings=[embed_text(query)],
        n_results=top_k
    )

    # ì ìˆ˜ í†µí•©
    combined_scores = (
        alpha * normalize(bm25_scores) +
        (1 - alpha) * normalize(vector_results['distances'])
    )

    return top_k_results(combined_scores)
```

#### 4. LangChain SQL Chain

```python
from langchain.chains import create_sql_query_chain
from langchain.sql_database import SQLDatabase

db = SQLDatabase(engine)

sql_chain = create_sql_query_chain(
    llm=llm,
    db=db,
    prompt=sql_prompt
)
```

#### 5. Memory Management

```python
import sqlite3

class ConversationMemory:
    def __init__(self):
        self.conn = sqlite3.connect('conversations.db')

    def add_message(self, session_id, role, content):
        self.conn.execute('''
        INSERT INTO conversations
        (session_id, role, content, timestamp)
        VALUES (?, ?, ?, datetime('now'))
        ''', (session_id, role, content))

    def get_recent(self, session_id, limit=5):
        cursor = self.conn.execute('''
        SELECT role, content
        FROM conversations
        WHERE session_id = ?
        ORDER BY timestamp DESC
        LIMIT ?
        ''', (session_id, limit))
        return list(reversed(cursor.fetchall()))
```

---

ì´ ì•„í‚¤í…ì²˜ëŠ” **ì™„ì „íˆ ë¬´ë£Œ ì˜¤í”ˆì†ŒìŠ¤** (LLM API ì œì™¸)ë¡œ êµ¬ì„±ë˜ì–´ ìˆìœ¼ë©°, ëª¨ë“  Mermaid ë‹¤ì´ì–´ê·¸ë¨ì´ **íŒŒì‹± ì—ëŸ¬ ì—†ì´ ë Œë”ë§**ë©ë‹ˆë‹¤.
